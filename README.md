# Weather API Test Framework

Данный проект представляет собой автоматизированные тесты для Weather API с использованием WireMock заглушек и Allure отчётов. Проект реализован согласно требованиям тестового задания с использованием BDD подхода.

## Описание проекта

Проект содержит:
- **Позитивные тесты**: Проверка текущей погоды для 4 городов (London, Paris, Tokyo, New York)
- **Негативные тесты**: Проверка 4 различных ошибок API (1002, 1003, 2006, 1006)
- **WireMock заглушки**: Эмуляция реального API без прямых запросов к внешнему сервису
- **Allure отчёты**: Подробные отчёты с результатами выполнения тестов
- **BDD подход**: Cucumber feature файлы с понятными сценариями на русском языке

## Технологический стек

- **Java 11+** - Язык программирования
- **Maven** - Система сборки
- **TestNG** - Фреймворк для тестирования
- **Cucumber** - BDD фреймворк
- **WireMock** - Мокирование HTTP сервисов
- **RestAssured** - HTTP клиент для API тестирования
- **Allure** - Система отчётности
- **Jackson** - Обработка JSON
- **SLF4J + Logback** - Логирование

## Требования

- Java 11 или выше
- Maven 3.6+
- Allure commandline (для генерации отчётов)

## Запуск тестов

### 1. Клонирование проекта
```bash
git clone <repository-url>
cd weather_api
```

### 2. Установка зависимостей
```bash
mvn clean install
```

### 3. Запуск всех тестов
```bash
mvn test
```

### 4. Запуск только позитивных тестов
```bash
mvn test -Dcucumber.filter.tags="@positive"
```

### 5. Запуск только негативных тестов
```bash
mvn test -Dcucumber.filter.tags="@negative"
```

## Генерация Allure отчётов

### 1. Генерация отчёта после выполнения тестов
```bash
allure generate target/allure-results --clean
```

### 2. Открытие отчёта в браузере
```bash
allure serve target/allure-results
```

### 3. Альтернативный способ через Maven
```bash
mvn allure:serve
```

## Описание тестов

### Позитивные тесты

**Проверяемые города:**
1. **London** - Частично облачно, умеренная температура
2. **Paris** - Солнечно, комфортная температура
3. **Tokyo** - Ясно, прохладная ночная температура
4. **New York** - Легкий снег, отрицательная температура

**Проверки:**
- Статус ответа 200
- Наличие информации о местоположении
- Корректность названия города и страны
- Наличие данных о текущей погоде
- Проверка температуры, влажности, ветра
- Логирование результатов сравнения

### Негативные тесты

**Проверяемые ошибки:**
1. **1002** - API key not provided (HTTP 401)
2. **1003** - Parameter 'q' not provided (HTTP 400)
3. **2006** - API key provided is invalid (HTTP 401)
4. **1006** - No location found matching parameter 'q' (HTTP 400)

**Проверки:**
- Правильный HTTP статус код
- Корректный код ошибки API
- Точное соответствие сообщения об ошибке
- Логирование результатов сравнения ошибок

## WireMock заглушки

Все тесты выполняются против WireMock сервера, который запускается автоматически на порту 8080. Заглушки находятся в директории `src/test/resources/wiremock/mappings/`:

**Позитивные заглушки:**
- `current_weather_london.json`
- `current_weather_paris.json`
- `current_weather_tokyo.json`
- `current_weather_newyork.json`

**Негативные заглушки:**
- `error_no_api_key.json` (1002)
- `error_no_city_param.json` (1003)
- `error_invalid_api_key.json` (2006)
- `error_location_not_found.json` (1006)

## Логирование

Все логи сохраняются в:
- **Консоль** - для отслеживания выполнения в реальном времени
- **Файл** - `target/logs/weather-api-tests.log` для последующего анализа

Уровни логирования:
- `INFO` - Основная информация о выполнении тестов
- `DEBUG` - Детальная информация для RestAssured запросов

## Настройка и конфигурация

### Изменение порта WireMock
В файле `WireMockHooks.java`:
```java
private static final int WIREMOCK_PORT = 8080;
```

### Настройка логирования
В файле `src/test/resources/logback-test.xml` можно изменить:
- Уровни логирования
- Формат вывода
- Путь к файлу логов

### Настройка Allure
В файле `src/test/resources/allure.properties`:
- Директория результатов
- Настройки ссылок
- Название тестового прогона

### BDD сценарии

Все сценарии написаны на русском языке в файле `src/test/resources/features/weather_api.feature`. Каждый сценарий содержит:
- Описание функционала
- Предыстория (Background)
- Шаги выполнения (Given/When/Then)
- Теги для фильтрации (@positive/@negative)

### Расширение проекта

Для добавления новых тестов:
1. Создайте новые WireMock заглушки в `mappings/`
2. Добавьте сценарии в feature файл
3. При необходимости создайте новые Step Definitions
4. Обновите POJO модели при изменении структуры API

---

## Готово!

Проект полностью настроен и готов к использованию. После запуска тестов вы получите:
- Подробные логи выполнения
- Cucumber HTML отчёты в `target/cucumber-reports/`
- Allure отчёты для детального анализа
- Все результаты сравнения в логах

**Автор:** Weather API Test Framework  
**Версия:** 1.0.0  
**Дата:** 2025 